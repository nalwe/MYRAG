{% extends "base.html" %}

{% block content %}
<div class="max-w-6xl mx-auto p-6 flex gap-6">

  <!-- ================= SIDEBAR (FOLDERS) ================= -->
  <aside class="w-64 shrink-0">

    <h2 class="font-semibold mb-3">ğŸ“‚ Folders</h2>

    <!-- ALL DOCUMENTS -->
    <a href="{% url 'documents:document_list' %}"
       class="block px-3 py-2 rounded mb-1
       {% if not active_folder %}bg-blue-100{% else %}hover:bg-gray-100{% endif %}">
      ğŸ“ All Documents
    </a>

    <!-- USER FOLDERS -->
    {% for folder in folders %}
      <a href="?folder={{ folder.id }}"
         class="block px-3 py-2 rounded mb-1
         {% if active_folder == folder.id %}bg-blue-100{% else %}hover:bg-gray-100{% endif %}">
        ğŸ“‚ {{ folder.name }}
      </a>
    {% empty %}
      <p class="text-sm text-gray-500 px-2">
        No folders
      </p>
    {% endfor %}
  </aside>

  <!-- ================= MAIN CONTENT ================= -->
  <section class="flex-1">

    <!-- ================= HEADER ================= -->
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold">ğŸ“„ Documents</h1>

      <div class="flex gap-3">
        <a href="{% url 'documents:my_documents' %}"
           class="px-4 py-2 border rounded text-sm hover:bg-gray-100">
          ğŸ“ My Documents
        </a>

        <a href="{% url 'documents:document_upload' %}"
           class="px-4 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
          â• Upload
        </a>
      </div>
    </div>

    <!-- ================= SEARCH ================= -->
    <form method="get" class="mb-6 flex gap-2">
      {% if active_folder %}
        <input type="hidden" name="folder" value="{{ active_folder }}">
      {% endif %}

      <input
        type="text"
        name="q"
        value="{{ query }}"
        placeholder="Search documents..."
        class="flex-1 border rounded px-4 py-2 text-sm focus:ring focus:ring-blue-200"
      >

      <button
        type="submit"
        class="px-4 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">
        ğŸ” Search
      </button>

      {% if query %}
        <a href="{% if active_folder %}?folder={{ active_folder }}{% else %}{% url 'document_list' %}{% endif %}"
           class="px-4 py-2 border rounded text-sm hover:bg-gray-100">
          âœ– Clear
        </a>
      {% endif %}
    </form>

    <!-- ================= DOCUMENT LIST ================= -->
    {% if documents %}
      <div class="grid gap-4">
        {% for doc in documents %}
          <div class="border rounded p-4 flex justify-between items-center hover:bg-gray-50">

            <!-- INFO -->
            <div>
              <p class="font-medium">
                {{ doc.display_name }}
              </p>

              <p class="text-xs text-gray-500">
                Uploaded {{ doc.created_at|date:"M d, Y" }}

                {% if doc.folder %}
                  â€¢ ğŸ“‚ {{ doc.folder.name }}
                {% endif %}

                {% if doc.organization %}
                  â€¢ {{ doc.organization.name }}
                {% else %}
                  â€¢ Public
                {% endif %}
              </p>
            </div>

            <!-- ACTIONS -->
            <div class="flex items-center gap-4 text-sm">

              <a href="{% url 'chat_view' %}?doc={{ doc.id }}"
                 class="text-blue-600 hover:underline">
                ğŸ’¬ Chat
              </a>

              <a href="{% url 'documents:document_preview' doc.id %}"
                 class="text-gray-600 hover:underline">
                ğŸ‘€ Preview
              </a>

              <a href="{% url 'documents:document_download' doc.id %}"
                 class="text-gray-600 hover:underline">
                â¬‡ï¸ Download
              </a>

            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-gray-500 mt-10">
        No documents found.
      </p>
    {% endif %}

  </section>
</div>
{% endblock %}
